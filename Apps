local url = "https://raw.githubusercontent.com/sjtumc/cc/master"
local index = ""
local folderList = {}
local fileList = {}

--check whether or not enable the http api
if not http then
	printError("This function  requires http API")
	printError("Set http_enable to true in ComputerCraft.cfg")
	return
end


--init program download some message from Insernet
local function init()
	--load index
	local text -- used to save list message
	local response = http.get(url .. "index")
	if not response then return false end
	index = response.readAll()
	print("Get index success")
	response.close()
	
	
	--load folder list
	response = http.get(url .. "folderList")
	if not response then return false end
	text = response.readLine()
	while text ~= EOF do
		folderList[text] = true
		text = response.readLine()
	end
	print("Get folder list success")
	response.close()
	print("Init success")
	print("Try input \"help\"")
	return true
end


--download program from server
local function download(name)
	--check the name
	if fileList[name] then	 
		--if the name is a file name, then download it immediately
		local response = http.get(url .. name)
		if not response then 
			print("Can't find " .. name .. " on server")
			return false --if cannot find the file, return false
		end	
		local f = fs.open(name, "w")	--write the code in local file
		f.write(response.readAll())
		f.close()
		response.close()
		return true
	else 
		print("Can't find " .. name .. " on server")
		return false
	end
end

local function help()
	print("Usages:")
	print("    list: show the Apps on the server")
	print("    download <fileName>: download code to local")
end

local args = {...}
    if  #args == 0 then
		help()
	end
	if 	#args == 2 then
		local command = arg[1]
		local file = arg[2]
		file = shell.resolve(file)
		if(command == "download") then
			if(fs.exists(file)) then
				print(file .. " already exist")
			else
				print("\nDownloading...")
				if download(file) then
					print("Download success")
				else
					print("Download failure")
				end
			end
		end
	end
	if #args == 1 then
		local input=arg[1]
	    if(input == "Apps") then
		  print("Sorry,it's under Developing")
	    elseif(input == "help") then
		  print("")
		  help()
	    else
		  print(input .." is not a command")
		  print("try reference to \"help\"")
	    end
	end
end